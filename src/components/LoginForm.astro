<form id="loginForm" class="space-y-4 max-w-md mx-auto">
  <div>
    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
    <input
      type="email"
      name="email"
      id="email"
      required
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
    />
  </div>

  <div>
    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
    <input
      type="password"
      name="password"
      id="password"
      required
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
    />
  </div>

  <button
    type="submit"
    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
  >
    Login
  </button>

  <div id="error-message" class="text-red-600 text-sm hidden"></div>
  
  <p class="text-center text-sm text-gray-600">
    Don't have an account?
    <a href="/register" class="text-blue-600 hover:underline">Register here</a>
  </p>
</form>

<script>
  import { supabase } from '../lib/supabase';

  const form = document.getElementById('loginForm');
  const errorMessage = document.getElementById('error-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target as HTMLFormElement);
    const email = formData.get('email') as string;
    const password = formData.get('password') as string;

    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) {
        throw error;
      }
      
      if (data.user) {
        console.log('Login successful:', data);
        // Wait for session to be set
        await new Promise(resolve => setTimeout(resolve, 100));
        // Reload the page to update session state
        window.location.replace('/dashboard');
        return;
      }
    } catch (error: any) {
      console.error('Login error:', error);
      if (errorMessage) {
        errorMessage.textContent = error.message;
        errorMessage.classList.remove('hidden');
      }
    }
  });
</script> 